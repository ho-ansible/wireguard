[NetDev]
Name={{ wg_name }}
Kind=wireguard
Description=Wireguard VPN

[WireGuard]
ListenPort={{ wg_port }}
PrivateKey={{ wg_privkey }}
{% for key, value in wg_server_opts %}
{{ key }}={{ value }}
{% endfor %}

{% for peer in wg_peers %}
[WireGuardPeer] # {{ peer }}
AllowedIPs={{ wg_ip | ipaddr('address') }}/32
PublicKey={{ hostvars[peer].wg_pubkey }}
{% for key, value in hostvars[peer].wg_client_opts %}
{{ key }}={{ value }}
{% endfor %}

{% endfor %}
