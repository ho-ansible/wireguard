[Match]
Name={{ wg_name }}

[Network]
Address={{ wg_ip }}

{{ wg_network_opts | d() }}

{% set routes = [] %}
{% for peer in q('inventory_hostnames', wg_peers) | sort
  if peer != inventory_hostname and hostvars[peer].wg_routes is defined %}
{%   set routes = routes.append(hostvars[peer].wg_routes) %}
{% endfor %}
{% for subnet in routes | flatten | sort %}
[Route]
Destination={{ subnet }}

{% endfor %}
